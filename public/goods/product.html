<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <link rel="stylesheet" href="./_css/product.css">

    <!-- header & footer 的引用-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"></script>
    <script src="../_js/public.js"></script>
    <link rel="stylesheet" href="../_css/public.css">

    <!-- 購物車引用 JS -->
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="../_js/shoppingCartIcon.js"></script>
    <link rel="stylesheet" href="../_css/shoppingCartIcon.css">
    

</head>



<body>

     <!-- ==========header 開始========== -->
    <header class="nav-header header d-flex align-items-center fixed-top py-4 px-3">
      <div class="container-fluid position-relative d-flex align-items-center justify-content-between">
  
        <a href="../index.html" class="navbar-brand col-5 col-md-3 nav-logo ">
          <img src="../_images/logo/pokemon_popup_logo.svg" />
        </a>
  
        <div class="d-flex ">
          <!-- 電腦版菜單 -->
          <div class="header-navibar px-4 d-none d-md-flex">
            <button class="nav-button shadow-drop-2-center bn-transition mx-2">
              <a href="../reservation/reservation.html">
                <span class="nav-button-text"><span>&nbsp;RESERVATION&nbsp;<span>預約入場</span></span>
              </a>
            </button>
            <button class="nav-button shadow-drop-2-center bn-transition mx-2">
              <a href="../goods/goods.html">
                <span class="nav-button-text"><span>&nbsp;GOODS&nbsp;<span>快閃商品</span></span>
              </a>
            </button>
            <button class="nav-button shadow-drop-2-center bn-transition mx-2">
              <a href="./menu.html">
                <span class="nav-button-text"><span>&nbsp;MENU&nbsp;<span>餐點菜單</span></span>
              </a>
            </button>
            <button class="nav-button shadow-drop-2-center bn-transition mx-2">
              <a href="../game/game.html">
                <span class="nav-button-text"><span>&nbsp;GAME&nbsp;<span>大冒險</span></span>
              </a>
            </button>
          </div>
  
          <!-- 購物車按鈕 -->
          <div class="navbar-cart" id="openNav" onclick="openNav()">
            <img src="../_images/icon/cart_icon.svg" alt="購物車圖示">
          </div>
          <!-- 購物車導覽列小圖片 -->
          <div id="mySidenav" class="sidenav">
            <!-- 關閉標籤 -->
            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a><br>
            <!-- 提示訊息 -->
            <div id="buyprompt_message"></div>
            <!-- 商品小卡 -->
            <ul id="result_goodslist" class="result_goodslist"></ul><br><br>
          </div>
          <div id="backgroundOverlay" onclick="closeNav()">
          </div>
  
          <!-- 手機版菜單 -->
          <!-- 手機按鈕icon -->
          <button class="navbar-toggler d-md-none d-block col-3 border-0" type="button" data-bs-toggle="offcanvas"
            data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
            <object class="menu-icon" data="../_images/icon/menu_icon.svg" type="image/svg+xml"></object>
          </button>
          <!-- 手機offcanvas菜單 開始 -->
          <div class="offcanvas offcanvas-end header-navibar-sm d-md-none d-block px-3" tabindex="-1" id="offcanvasNavbar"
            aria-labelledby="offcanvasNavbarLabel">
            <!-- 手機offcanvas標題 -->
            <div class="offcanvas-header mt-3 rounded-pill px-4 py-2 justify-content-between">
  
              <object id="offcanvasNavbarLabel" data="../_images/logo/pokemon_popup_logo.svg"></object>
  
              <button type="button" class="border-0 bg-transparent d-flex" data-bs-dismiss="offcanvas" aria-label="Close">
                <object class="menu-icon" data="../_images/icon/close_icon.svg" type="image/svg+xml"></object>
              </button>
  
            </div>
            <!-- 手機offcanvas項目 -->
            <div class="offcanvas-body px-4">
              <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="./main/index.html">首頁｜<span>HOME</span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="./reservation/reservation.html">預約入場｜<span>RESERVATION</span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="./goods/goods.html">快閃商品｜<span>GOODS</span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link " href="./menu.html">餐點菜單｜<span>MENU</span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link " href="./game/game.html">心理測驗｜<span>GAME</span></a>
                </li>
              </ul>
            </div>
          </div>
  
        </div>
  
      </div>
    </header>
  
    <!-- ==========header 結束========== -->

    <br><br><br>
    <br><br><br>
    <div class="container TextAll" style="max-width: 1200px;">
        <div id="result_product" class="row justify-content-center">
            
        </div>

    </div>

    <br><br><br>
    <!-- ==========footer 開始========== -->
    <footer id="footer">
        <div class="footer-contnet flex-fill">
          <div class="footer-navbar flex-fill">
    
            <div class="footer-logo">
              <object data="../_images/logo/pokemon_popup_logo.svg"></object>
            </div>
    
            <div class="footer-item flex-fill">
    
              <div class="footer-social flex-fill">
                <button class=""><img src="../_images/icon/social_icon_fb.png" alt="facebook"></button>
                <button class=""><img src="../_images/icon/social_icon_ig.png" alt="instagram"></button>
              </div>
    
              <div class="footer-link">
                <button class="">
                  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px"
                    y="0px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve">
                    <path class="st0" d="M23.9,2.4c0-0.1-0.1-0.2-0.1-0.3c0-0.1-0.1-0.2-0.1-0.3c0-0.1-0.1-0.2-0.2-0.3c0-0.1-0.1-0.1-0.1-0.2
                   C23.3,1,23,0.7,22.7,0.5c-0.1,0-0.1-0.1-0.2-0.1c-0.1-0.1-0.2-0.1-0.3-0.2c-0.1,0-0.2-0.1-0.3-0.1c-0.1,0-0.2-0.1-0.3-0.1
                   C21.4,0,21.2,0,21,0H3C1.3,0,0,1.3,0,3s1.3,3,3,3h10.8L0.9,18.9c-1.2,1.2-1.2,3.1,0,4.2C1.5,23.7,2.2,24,3,24s1.5-0.3,2.1-0.9
                   L18,10.2V21c0,1.7,1.3,3,3,3s3-1.3,3-3V3C24,2.8,24,2.6,23.9,2.4z" />
                  </svg>
                  隱私權政策
                </button>
                <button class="">
                  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px"
                    y="0px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve">
                    <path class="st0" d="M23.9,2.4c0-0.1-0.1-0.2-0.1-0.3c0-0.1-0.1-0.2-0.1-0.3c0-0.1-0.1-0.2-0.2-0.3c0-0.1-0.1-0.1-0.1-0.2
                 C23.3,1,23,0.7,22.7,0.5c-0.1,0-0.1-0.1-0.2-0.1c-0.1-0.1-0.2-0.1-0.3-0.2c-0.1,0-0.2-0.1-0.3-0.1c-0.1,0-0.2-0.1-0.3-0.1
                 C21.4,0,21.2,0,21,0H3C1.3,0,0,1.3,0,3s1.3,3,3,3h10.8L0.9,18.9c-1.2,1.2-1.2,3.1,0,4.2C1.5,23.7,2.2,24,3,24s1.5-0.3,2.1-0.9
                 L18,10.2V21c0,1.7,1.3,3,3,3s3-1.3,3-3V3C24,2.8,24,2.6,23.9,2.4z" />
                  </svg>
                  常見問題
                </button>
              </div>
    
            </div>
    
          </div>
          <p class="my-0">©Pokémon. ©Nintendo/Creatures Inc. /GAME FREAK inc.</p>
        </div>
    
      </footer>
      <!-- ==========footer 結束========== -->

    <script>
        
        // 點選縮圖圖片替換大圖
        function myFunction(imgs) {
            var expandImg = document.getElementById("expandedImg"); // 取得展開後的影像
            expandImg.src = imgs.src;
            expandImg.parentElement.style.display = "block";
        }

        // 商品導入
        window.onload = function () {

        urlStr = location.href;
        url = new URL(urlStr);
        let productID = url.searchParams.get('id')? url.searchParams.get('id') : 1 ;     // 商品 ID, 預設ID=1
        // let apiUrl = 'http://localhost/mfee51/root/backEnd/api/product/product.php';
        let apiUrl = 'http://localhost/pokemon-popup-gruop/backEnd/api/product/product.php'
        let Exist_apiUrl = apiUrl + '?productID=' + productID;

        return new Promise((resolve, reject) => {
            $.ajax({
                url: Exist_apiUrl,
                method: 'GET',
                success: function (dataStr) {
                    data = JSON.parse(dataStr);
                    console.log(data);
                    result = ` `;

                    for(row of data){
                        // 迴圈縮圖
                        var productImg = ''
                        for(picUrl of row['productImg']){
                            productImg += `
                                <img src="${picUrl['productImg']}"  onclick="myFunction(this);" />
                                `                            
                        }
                        // 判斷特殊標籤
                        var productTags = '';
                        if( row['storeOnly'] === 1 ){
                            productTags +=`
                            <span class="product_tag">會場限定</span>
                        `;
                        }
                        if( row['productMain'] === 1 ){
                            productTags +=`
                                <span class="product_tag">限量商品</span>
                            `;
                        }

                        // 印出商品頁面
                        result += `

                        <div class="col-md-1 column"> ${productImg}  </div>

                        
                        <div class="col-md-5 MainProduct">
                            <img id="expandedImg" src="${row['productImg'][0]['productImg']}">

                        </div>

                        <div class="col-md-4 ProductDescription">
                            ${productTags}
                            <div>
                                <h2>${row['productName']}</h2>
                                <p>${row['productDescribe']}</p>
                            </div>
                            <div>
                                <span class="Activity_tag">活動</span><p>【買一送一，下單1出貨2】</p><br>
                                <span class="Activity_tag">贈品</span><p>【全站滿$1,500 送限量貼紙】</p><br>
                            </div>
                            <div class="bg_card">
                                <p class="bg_cardtexth3">售價$${row['productPrice'].toLocaleString()}</p>
                                <p style="color: #3F3A3A;">庫存 <span id="stock">${row['productInStock']}</span> 件</p>

                                <!-- 購物車按鈕 -->
                                <div class="row justify-content-around">
                                    <button class="btn-decrement" id="btn-decrement">-</button>
                                    <span name="num" class="quantity">1</span>
                                    <button class="btn-increment">+</button>
                                    <button class="btn-add-to-cart">加入購物車</button>
                                </div>

                            </div>
                        </div>
                    
                        `;

                    result +=` `;

                    $('#result_product').html(result);
                    console.log('輸出成功');

                    }

                    resolve(); // 完成 AJAX 請求後解析 Promise
                    },
                error: function(err) {
                    reject(err); // 如果請求出錯，拒絕 Promise
                }
            });
    }).then(() => {
        // console.log('sc_msg');
    });
    }

    // 購物車按鈕----------------------------------------------------->

    $(document).ready(function() {
            // 使用事件委托绑定點擊事件到動態+載的btn
            // -- 不低於數量 1
            $('#result_product').on('click', '.btn-decrement', function() {
                let stockElement = parseInt($('#stock').text());
                let quantity = parseInt($(this).next().text());
                (quantity>1)? quantity-- : console.log('oh! no 數量不得低於1');
                $('span[name="num"]').html(quantity);
            });
            // ++ 不超過庫存數
            $('#result_product').on('click', '.btn-increment', function() {
                let stockElement = parseInt($('#stock').text());
                let quantity = parseInt($(this).prev().text());
                (  stockElement > quantity  )? quantity++ : console.log('oh! no 庫存不夠') ;
                $('span[name="num"]').html(quantity);
            });
        })


    </script>
    
</body>
</html>